<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>주차장 실태 관리 목록</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --text:#1f2937; --muted:#6b7280;
    --primary:#2563eb; --primary-2:#1d4ed8; --ring:rgba(37,99,235,.35);
    --border:#e5e7eb; --badge:#eef2ff; --ok:#16a34a; --warn:#f59e0b; --err:#dc2626;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8;
      --primary:#3b82f6; --primary-2:#2563eb; --ring:rgba(59,130,246,.35);
      --border:#20304f; --badge:#0b1220;
    }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans KR",sans-serif;
    background: var(--bg); color:var(--text);
    display:flex; flex-direction:column; gap:16px; padding:16px;
  }
  .wrap{max-width:1220px; margin:0 auto; width:100%}
  .title{font-size:1.25rem; font-weight:700; margin:4px 0 0}
  .sub{color:var(--muted); margin:0 0 10px}

  .panel{
    background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px;
  }
  .filters{
    display:grid; gap:10px;
    grid-template-columns: 1fr 1fr;
  }
  @media (min-width: 900px){
    .filters{ grid-template-columns: repeat(4, 1fr); }
  }
  label{font-size:.88rem; color:var(--muted)}
  .control{
    display:flex; align-items:center; gap:8px;
    border:1px solid var(--border); border-radius:12px; padding:10px 12px; background:transparent;
  }
  .control:focus-within{ outline:3px solid var(--ring); outline-offset:1px }
  select,input[type="text"]{
    width:100%; border:0; outline:0; background:transparent; color:var(--text); font-size:1rem;
  }

  .actions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
  .btn{
    border:0; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600;
    background:linear-gradient(180deg,var(--primary),var(--primary-2)); color:#fff;
  }
  .btn.sec{ background:#eef2ff; color:#1e40af; border:1px solid var(--border) }
  .btn.ghost{ background:transparent; color:var(--primary); border:1px solid var(--border) }
  .btn:active{ transform:translateY(1px) }

  .result-panel{ display:grid; gap:8px }
  .summary{ color:var(--muted); font-size:.9rem }

  /* ====== 탭 ====== */
  .tabs{ display:flex; gap:6px; border-bottom:1px solid var(--border); margin-top:8px }
  .tab-btn{
    appearance:none; background:transparent; border:1px solid transparent; border-bottom:0;
    padding:10px 14px; border-radius:12px 12px 0 0; cursor:pointer; font-weight:700; color:var(--muted);
  }
  .tab-btn.active{
    color:var(--text); background:var(--card); border-color:var(--border) var(--border) transparent var(--border);
  }
  .tab-panels{ border:1px solid var(--border); border-radius:0 14px 14px 14px; overflow:hidden; background:var(--card) }

  /* 목록 패널 내부 여백 */
  .tab-panel{ padding:10px }
  .tab-panel[hidden]{ display:none }

  /* ====== 리스트 뷰: 카드/테이블 ====== */
  /* 기본값: 카드는 보이고, 테이블은 숨김 (모바일/아이패드 포함) */
  .table-wrap{ display:none }
  .cards{ display:grid }

  /* 데스크톱(넓은 화면 + 마우스 포인터)에서만 테이블 보이기 */
  @media (min-width: 1100px) and (hover:hover) and (pointer:fine){
    .table-wrap{ display:block }
    .cards{ display:none }
  }

  /* 테이블 (데스크톱) */
  .table-wrap{ background:var(--card); border-top:1px solid var(--border) }
  table{ width:100%; border-collapse:collapse; font-size:.95rem }
  thead th{
    text-align:left; background:#f3f4f6; padding:12px; position:sticky; top:0; z-index:1; border-bottom:1px solid var(--border);
  }
  tbody td{ padding:12px; border-top:1px solid var(--border) }
  tbody tr:hover{ background: rgba(37,99,235,.04); cursor:pointer }
  .addr{ color:var(--muted) }
  .num, .check { text-align:center }
  .check input{ width:18px; height:18px }

  /* 카드 목록 */
  .cards{ gap:10px; }
  .card{
    background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px;
    display:grid; gap:6px; cursor:pointer;
  }
  .card .name{ font-weight:700 }
  .badge{
    display:inline-block; font-size:.78rem; padding:4px 8px; border-radius:999px; background:var(--badge); border:1px solid var(--border)
  }
  .status.appr{ color:var(--ok) } .status.pend{ color:var(--warn) } .status.reject{ color:var(--err) }

  .pager{ display:flex; justify-content:center; gap:6px; flex-wrap:wrap; margin:10px 0 }
  .page-btn{ padding:8px 12px; border-radius:10px; border:1px solid var(--border); background:transparent; cursor:pointer }
  .page-btn.active{ background:linear-gradient(180deg,var(--primary),var(--primary-2)); color:#fff; border-color:transparent }
  .page-btn:disabled{ opacity:.5; cursor:not-allowed }
  .right{ margin-left:auto }

  .muted{ color:var(--muted) }

  /* 상세(iframe) */
  .detail-wrap{ background:var(--card) }
  #detailFrame{ width:100%; height:70vh; border:0; display:block }
</style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">주차장 실태 관리 목록</h1>
    <p class="sub">모바일/아이패드: 카드 전용 · 데스크톱: 테이블/카드 자동 전환 · 탭(목록/상세)</p>

    <!-- 검색 패널 -->
    <section class="panel" aria-label="검색 조건">
      <form id="searchForm">
        <div class="filters">
          <div>
            <label for="sido">시도</label>
            <div class="control">
              <select id="sido" name="sido">
                <option value="">전체</option>
              </select>
            </div>
          </div>

          <div>
            <label for="sigungu">시군구</label>
            <div class="control">
              <select id="sigungu" name="sigungu" disabled>
                <option value="">전체</option>
              </select>
            </div>
          </div>

          <div>
            <label for="emd">읍면동</label>
            <div class="control">
              <select id="emd" name="emd" disabled>
                <option value="">전체</option>
              </select>
            </div>
          </div>

          <div>
            <label for="prkNm">주차장명</label>
            <div class="control">
              <input id="prkNm" name="prkNm" type="text" placeholder="예) 중앙공영주차장" />
            </div>
          </div>

          <div>
            <label for="prkType">주차장형태</label>
            <div class="control">
              <select id="prkType" name="prkType">
                <option value="">전체</option>
                <option>노상</option>
                <option>노외</option>
                <option>부설</option>
              </select>
            </div>
          </div>

          <div>
            <label for="status">진행상태</label>
            <div class="control">
              <select id="status" name="status">
                <option value="">전체</option>
                <option value="APPROVED">승인</option>
                <option value="PENDING">진행중</option>
                <option value="REJECTED">반려</option>
                <option value="TEMP">임시저장</option>
              </select>
            </div>
          </div>

          <div class="span2">
            <label for="addr">상세주소</label>
            <div class="control">
              <input id="addr" name="addr" type="text" placeholder="도로명/지번 등 일부를 입력" />
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn">검색</button>
          <button type="button" id="resetBtn" class="btn ghost">초기화</button>
          <button type="button" id="exportBtn" class="btn sec">CSV 내보내기</button>
          <span class="right muted" id="hint">데모 데이터 기반 클라이언트 필터링</span>
        </div>
      </form>
    </section>

    <!-- 결과/탭 -->
    <section class="result-panel">
      <div class="summary" id="summary">총 0건</div>

      <!-- 탭 헤더 -->
      <div class="tabs" role="tablist" aria-label="목록/상세">
        <button id="tabList" class="tab-btn active" role="tab" aria-controls="panelList" aria-selected="true">목록</button>
        <button id="tabDetail" class="tab-btn" role="tab" aria-controls="panelDetail" aria-selected="false">상세</button>
      </div>

      <!-- 탭 패널 -->
      <div class="tab-panels">
        <!-- 목록 패널 -->
        <div id="panelList" class="tab-panel" role="tabpanel" aria-labelledby="tabList">
          <!-- 카드 (모바일/아이패드 우선) -->
          <div id="cards" class="cards" aria-label="검색 결과 - 카드 목록"></div>

          <!-- 테이블 (데스크톱에서만 노출) -->
          <div class="table-wrap" aria-label="검색 결과 - 테이블">
            <table>
              <thead>
                <tr>
                  <th style="width:64px" class="num">순번</th>
                  <th style="width:60px" class="check">
                    <input id="checkAll" type="checkbox" aria-label="현재 페이지 전체 선택" />
                  </th>
                  <th style="width:10%">주차장구분</th>
                  <th style="width:10%">진행상태</th>
                  <th style="width:12%">시도</th>
                  <th style="width:12%">시군구</th>
                  <th style="width:12%">읍면동</th>
                  <th>상세주소</th>
                  <th style="width:18%">주차장명</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div id="pager" class="pager" role="navigation" aria-label="페이지네이션"></div>
        </div>

        <!-- 상세 패널 -->
        <div id="panelDetail" class="tab-panel detail-wrap" role="tabpanel" aria-labelledby="tabDetail" hidden>
          <iframe id="detailFrame" allow="geolocation" title="상세보기"></iframe>
        </div>
      </div>
    </section>
  </div>

<script>
/** ====== 데모 데이터/행정구역 ====== */
const ADM = {
  "서울특별시": {
    "종로구": ["사직동","삼청동","평창동","청운효자동"],
    "마포구": ["아현동","도화동","연남동","상암동"]
  },
  "경기도": {
    "성남시 분당구": ["정자동","수내동","서현동","야탑동"],
    "용인시 수지구": ["풍덕천동","상현동","성복동"]
  },
  "대전광역시": {
    "유성구": ["궁동","봉명동","신성동"],
    "서구": ["둔산동","가수원동","탄방동"]
  }
};

// 데모 주차장 데이터 (type: 노상/노외/부설만 사용)
const DATA = [
  {nm:"중앙공영주차장", type:"노상", status:"APPROVED", sido:"서울특별시", sigungu:"종로구", emd:"사직동", addr:"사직로 1", manageNo:"PRK-0001"},
  {nm:"연남로 노상", type:"노상", status:"PENDING",  sido:"서울특별시", sigungu:"마포구", emd:"연남동", addr:"연남로 123", manageNo:"PRK-0002"},
  {nm:"상암DMC 복합", type:"부설", status:"TEMP",    sido:"서울특별시", sigungu:"마포구", emd:"상암동", addr:"월드컵북로 400", manageNo:"PRK-0003"},
  {nm:"분당구청 노외", type:"노외", status:"APPROVED",sido:"경기도", sigungu:"성남시 분당구", emd:"정자동", addr:"분당로 23", manageNo:"PRK-0004"},
  {nm:"서현역 노외",  type:"노외", status:"REJECTED",sido:"경기도", sigungu:"성남시 분당구", emd:"서현동", addr:"황새울로 333", manageNo:"PRK-0005"},
  {nm:"수지 성복 부설", type:"부설", status:"APPROVED",sido:"경기도", sigungu:"용인시 수지구", emd:"성복동", addr:"성복로 77", manageNo:"PRK-0006"},
  {nm:"DCC 노외",     type:"노외", status:"PENDING",  sido:"대전광역시", sigungu:"서구", emd:"둔산동", addr:"엑스포로 1", manageNo:"PRK-0007"},
  {nm:"KAIST 부설",   type:"부설", status:"APPROVED", sido:"대전광역시", sigungu:"유성구", emd:"궁동", addr:"대학로 291", manageNo:"PRK-0008"},
  {nm:"유성 홈플 노상", type:"노상", status:"TEMP",   sido:"대전광역시", sigungu:"유성구", emd:"봉명동", addr:"온천서로 11", manageNo:"PRK-0009"},
  {nm:"탄방동 노상",  type:"노상", status:"APPROVED", sido:"대전광역시", sigungu:"서구", emd:"탄방동", addr:"문정로 25", manageNo:"PRK-0010"},
];

const PAGE_SIZE = 6;

/* ====== 엘리먼트 ====== */
const $ = (s)=>document.querySelector(s);
const form = $('#searchForm');
const sidoSel = $('#sido');
const sggSel  = $('#sigungu');
const emdSel  = $('#emd');
const prkNm   = $('#prkNm');
const prkType = $('#prkType');
const status  = $('#status');
const addr    = $('#addr');

const tbody = $('#tbody');
const cards = $('#cards');
const pager = $('#pager');
const summary = $('#summary');
const checkAll = $('#checkAll');

const resetBtn = $('#resetBtn');
const exportBtn = $('#exportBtn');

const tabListBtn = $('#tabList');
const tabDetailBtn = $('#tabDetail');
const panelList = $('#panelList');
const panelDetail = $('#panelDetail');
const detailFrame = $('#detailFrame');

let currentPage = 1;
let filtered = [...DATA];
// 선택 상태(관리번호 기준) 유지
const selected = new Set();

/** ===== 행정구역 셀렉트 구성 ===== */
function initAdm(){
  Object.keys(ADM).forEach(sido=>{
    sidoSel.add(new Option(sido, sido));
  });

  sidoSel.addEventListener('change', ()=>{
    sggSel.innerHTML = '<option value="">전체</option>';
    emdSel.innerHTML = '<option value="">전체</option>';
    emdSel.disabled = true;

    const s = sidoSel.value;
    if(!s){ sggSel.disabled = true; return; }
    sggSel.disabled = false;
    Object.keys(ADM[s]).forEach(sgg=>{
      sggSel.add(new Option(sgg, sgg));
    });
  });

  sggSel.addEventListener('change', ()=>{
    emdSel.innerHTML = '<option value="">전체</option>';
    const s = sidoSel.value, g = sggSel.value;
    if(!g){ emdSel.disabled = true; return; }
    emdSel.disabled = false;
    ADM[s][g].forEach(e=> emdSel.add(new Option(e, e)));
  });
}

/** ===== 필터링 ===== */
function applyFilter(){
  const f = {
    sido: sidoSel.value.trim(),
    sgg : sggSel.value.trim(),
    emd : emdSel.value.trim(),
    nm  : prkNm.value.trim(),
    type: prkType.value.trim(),
    st  : status.value.trim(),
    ad  : addr.value.trim()
  };

  filtered = DATA.filter(r=>{
    if(f.sido && r.sido !== f.sido) return false;
    if(f.sgg && r.sigungu !== f.sgg) return false;
    if(f.emd && r.emd !== f.emd) return false;
    if(f.nm && !r.nm.includes(f.nm)) return false;
    if(f.type && r.type !== f.type) return false;
    if(f.st && r.status !== f.st) return false;
    if(f.ad && !(`${r.addr}`.includes(f.ad))) return false;
    return true;
  });

  currentPage = 1;
  render();
}

function badgeStatus(s){
  if(s==='APPROVED') return '<span class="badge status appr">승인</span>';
  if(s==='PENDING')  return '<span class="badge status pend">진행중</span>';
  if(s==='REJECTED') return '<span class="badge status reject">반려</span>';
  if(s==='TEMP')     return '<span class="badge">임시저장</span>';
  return `<span class="badge">${s}</span>`;
}

/** ===== 렌더링 (테이블 + 카드 + 페이지) ===== */
function render(){
  summary.textContent = `총 ${filtered.length}건`;

  const total = filtered.length;
  const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  if(currentPage > pages) currentPage = pages;
  const start = (currentPage - 1) * PAGE_SIZE;
  const pageRows = filtered.slice(start, start + PAGE_SIZE);

  // 테이블
  tbody.innerHTML = pageRows.map((r, i)=>{
    const seq = start + i + 1;
    const checked = selected.has(r.manageNo) ? 'checked' : '';
    return `
      <tr data-id="${r.manageNo}">
        <td class="num">${seq}</td>
        <td class="check"><input type="checkbox" class="row-check" ${checked} aria-label="선택: ${r.nm}" /></td>
        <td>${r.type}</td>
        <td>${badgeStatus(r.status)}</td>
        <td>${r.sido}</td>
        <td>${r.sigungu}</td>
        <td>${r.emd}</td>
        <td><span class="addr">${r.addr}</span></td>
        <td><strong>${r.nm}</strong><div class="muted">${r.manageNo}</div></td>
      </tr>
    `;
  }).join('');

  // 카드(모바일/아이패드)
  cards.innerHTML = pageRows.map(r=>`
    <article class="card" data-id="${r.manageNo}" aria-label="${r.nm}">
      <div class="name">${r.nm}</div>
      <div class="muted">${r.manageNo}</div>
      <div><span class="badge">${r.type}</span> · ${badgeStatus(r.status)}</div>
      <div class="muted">${r.sido} ${r.sigungu} ${r.emd}</div>
      <div class="addr">${r.addr}</div>
    </article>
  `).join('');

  // 페이지네이션
  renderPager(pages);

  // 체크박스 이벤트
  bindRowChecks();

  // 행/카드 클릭 → 상세 탭 열기
  bindOpenDetailHandlers(pageRows);
}

function renderPager(pages){
  pager.innerHTML = '';
  const makeBtn = (txt, page, disabled=false, active=false)=>{
    const b = document.createElement('button');
    b.className = 'page-btn' + (active?' active':'');
    b.textContent = txt;
    b.disabled = disabled;
    b.addEventListener('click', ()=>{ currentPage = page; render(); });
    return b;
  };
  pager.appendChild(makeBtn('«', 1, currentPage===1));
  pager.appendChild(makeBtn('‹', Math.max(1,currentPage-1), currentPage===1));
  const span = 3;
  const from = Math.max(1, currentPage - span);
  const to   = Math.min(pages, currentPage + span);
  for(let p=from; p<=to; p++){
    pager.appendChild(makeBtn(String(p), p, false, p===currentPage));
  }
  pager.appendChild(makeBtn('›', Math.min(pages,currentPage+1), currentPage===pages));
  pager.appendChild(makeBtn('»', pages, currentPage===pages));
}

/** ===== 선택(체크박스) 처리 ===== */
function bindRowChecks(){
  document.querySelectorAll('.row-check').forEach(chk=>{
    chk.addEventListener('change', (e)=>{
      const tr = e.target.closest('tr');
      const id = tr.dataset.id;
      if(e.target.checked) selected.add(id);
      else selected.delete(id);
      syncHeaderCheck();
    });
  });
}

function syncHeaderCheck(){
  const visible = Array.from(tbody.querySelectorAll('tr')).map(tr=>tr.dataset.id);
  const allChecked = visible.length>0 && visible.every(id=>selected.has(id));
  checkAll.checked = allChecked;
  checkAll.indeterminate = !allChecked && visible.some(id=>selected.has(id));
}

checkAll.addEventListener('change', ()=>{
  const visible = Array.from(tbody.querySelectorAll('tr')).map(tr=>tr.dataset.id);
  if(checkAll.checked){
    visible.forEach(id=>selected.add(id));
  }else{
    visible.forEach(id=>selected.delete(id));
  }
  Array.from(tbody.querySelectorAll('.row-check')).forEach(chk=>{
    const id = chk.closest('tr').dataset.id;
    chk.checked = selected.has(id);
  });
  syncHeaderCheck();
});

/** ===== CSV 내보내기 ===== */
function exportCSV(){
  const header = ['순번','관리번호','주차장구분','진행상태','시도','시군구','읍면동','상세주소','주차장명'];
  const rows = filtered.map((r, idx)=>[
    idx+1, r.manageNo, r.type,
    (r.status==='APPROVED'?'승인':r.status==='PENDING'?'진행중':r.status==='REJECTED'?'반려':r.status==='TEMP'?'임시저장':r.status),
    r.sido, r.sigungu, r.emd, r.addr, r.nm
  ]);
  const csv = [header, ...rows].map(cols =>
    cols.map(v => {
      const s = String(v ?? '').replace(/"/g,'""');
      return /[",\n]/.test(s) ? `"${s}"` : s;
    }).join(',')
  ).join('\n');

  const blob = new Blob(["\uFEFF"+csv], {type: "text/csv;charset=utf-8;"}); // BOM for Excel
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'parking_list.csv';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

/** ===== 탭 전환 ===== */
function activateTab(which){ // 'list' | 'detail'
  const listActive = which==='list';
  tabListBtn.classList.toggle('active', listActive);
  tabDetailBtn.classList.toggle('active', !listActive);
  tabListBtn.setAttribute('aria-selected', String(listActive));
  tabDetailBtn.setAttribute('aria-selected', String(!listActive));
  panelList.hidden = !listActive;
  panelDetail.hidden = listActive;
}
tabListBtn.addEventListener('click', ()=> activateTab('list'));
tabDetailBtn.addEventListener('click', ()=> activateTab('detail'));

/** ===== 상세 로딩 ===== */
function buildDetailUrl(rec){
  // 주차장형태별 파일 매핑
  const map = { '노상':'offpaking.html', '노외':'onpaking.html', '부설':'buildpaking.html' };
  const file = map[rec.type] || 'offpaking.html';

  const sp = new URLSearchParams({
    id: rec.manageNo,
    name: rec.nm,
    status: rec.status,
    sido: rec.sido,
    sigungu: rec.sigungu,
    emd: rec.emd,
    addr: rec.addr
  });
  return `${file}?${sp.toString()}`;
}
function openDetail(rec){
  const url = buildDetailUrl(rec);
  detailFrame.src = url;
  activateTab('detail');
}

/** 목록에서 클릭(행/카드) → 상세 열기 */
function bindOpenDetailHandlers(pageRows){
  // 테이블 행: tbody 이벤트 위임
  tbody.onclick = (e)=>{
    const target = e.target;
    if (target.closest('input,button,label,a')) return; // 체크박스 등 클릭은 통과
    const tr = target.closest('tr'); if(!tr) return;
    const id = tr.dataset.id;
    const rec = pageRows.find(r=>r.manageNo===id);
    if(rec) openDetail(rec);
  };
  // 카드: 컨테이너 위임
  cards.onclick = (e)=>{
    const card = e.target.closest('.card'); if(!card) return;
    const id = card.dataset.id;
    const rec = pageRows.find(r=>r.manageNo===id);
    if(rec) openDetail(rec);
  };
}

/** ===== 이벤트 바인딩 ===== */
form.addEventListener('submit', e=>{ e.preventDefault(); applyFilter(); });
resetBtn.addEventListener('click', ()=>{
  form.reset();
  sggSel.innerHTML = '<option value="">전체</option>'; sggSel.disabled = true;
  emdSel.innerHTML = '<option value="">전체</option>'; emdSel.disabled = true;
  filtered = [...DATA]; currentPage = 1; render();
  selected.clear(); syncHeaderCheck();
});
exportBtn.addEventListener('click', exportCSV);

/** ===== 초기화 ===== */
function init(){
  initAdm();
  applyFilter(); // 내부에서 render 호출
  // 초기 탭은 목록
  activateTab('list');
}
init();

/** ===== 실제 연동 시 참고 (// TODO) =====
 * - 목록: GET /api/parkings?page=1&size=50&... (서버 페이징)
 * - 상세: type에 따른 파일/라우팅으로 매핑
 * - 선택항목 처리: POST /api/parkings/bulk (body: manageNo 배열)
 * - 코드/행정구역: /api/codes, /api/adm/{sido}/{sigungu}
 */
</script>
</body>
</html>