<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>브이월드 전용 지도 · 김천</title>

<!-- ★ VWorld 스크립트: key/domain 인코딩 없이 그대로 -->
<script src="https://map.vworld.kr/js/vworldMapInit.js.do?version=2.0&apiKey=CF9A371B-35A6-3822-8315-6592C8342E82&domain=psychic-pancake-r7q577jxr6ghwx9g-8080.app.github.dev"></script>

<style>
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans KR",sans-serif}
  #map{position:fixed;inset:0}
  .status{
    position:fixed;left:12px;top:12px;z-index:20;background:#0f172a;color:#e5e7eb;
    border:1px solid #20304f;border-radius:10px;padding:8px 10px;font-size:.92rem
  }
  .ok{color:#10b981}.bad{color:#ef4444}
</style>
</head>
<body>
<div class="status" id="stat">브이월드 초기화 중…</div>
<div id="map" aria-label="지도"></div>

<script>
(function(){
  const FALLBACK_CENTER = { lng:128.1136, lat:36.1398 }; // 김천(한국교통안전공단 인근)
  const stat = document.getElementById('stat');

  function ok(msg){ stat.innerHTML = `<span class="ok">✔</span> ${msg}`; }
  function bad(msg){ stat.innerHTML = `<span class="bad">✖</span> ${msg}`; }

  function initVWorld(){
    if(!(window.vw && vw.ol3)){
      bad('브이월드 객체(vw.ol3) 준비 안 됨');
      return;
    }
    // 브이월드 지도 생성
    const vmap = new vw.ol3.Map("map", {
      basemapType: vw.ol3.BasemapType.GRAPHIC,   // 기본 배경
      controlDensity: vw.ol3.DensityType.BASIC,
      interactionDensity: vw.ol3.DensityType.BASIC,
      controlsAutoArrange: true
    });

    // OpenLayers 맵 핸들
    const map = vmap.getMap ? vmap.getMap() : (vmap.map || vmap);
    if(!(window.ol && map && map.getView)){
      bad('OpenLayers 핸들 확보 실패'); return;
    }

    // 중심/줌 설정 (김천)
    const center = ol.proj.fromLonLat([FALLBACK_CENTER.lng, FALLBACK_CENTER.lat]);
    map.getView().setCenter(center);
    map.getView().setZoom(14);

    // 샘플 마커 (김천 중심점에 "P" 아이콘)
    const PARK_ICON_SVG =
      `<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 36 36'>
         <circle cx='18' cy='18' r='16' fill='#2563eb'/>
         <text x='18' y='22' font-family='Arial,Helvetica,sans-serif' font-size='16' text-anchor='middle' fill='#fff' font-weight='700'>P</text>
       </svg>`;
    const iconStyle = new ol.style.Style({
      image: new ol.style.Icon({
        src: 'data:image/svg+xml;utf8,' + encodeURIComponent(PARK_ICON_SVG.trim()),
        anchor:[0.5,0.5], anchorXUnits:'fraction', anchorYUnits:'fraction', scale:1.0
      })
    });
    const feat = new ol.Feature({ geometry: new ol.geom.Point(center) });
    feat.setStyle(iconStyle);

    const vec = new ol.source.Vector({ features:[feat] });
    const layer = new ol.layer.Vector({ source: vec, zIndex: 100 });
    map.addLayer(layer);

    ok('브이월드 지도 로딩 완료 (OSM 폴백 없음)');
  }

  // 브이월드 스크립트 로드 확인 후 초기화
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initVWorld);
  } else {
    initVWorld();
  }
})();
</script>
</body>
</html>