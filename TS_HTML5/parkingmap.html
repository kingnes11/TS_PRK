<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>주차장 지도 · 현재위치 중심 · 좌측 리스트 · 반경 1km · 행정경계</title>

<!-- VWorld 2D API (도메인 등록 必: 제공하신 키/도메인 사용) -->
<script src="https://map.vworld.kr/js/vworldMapInit.js.do?version=2.0&apiKey=CF9A371B-35A6-3822-8315-6592C8342E82&domain=psychic-pancake-r7q577jxr6ghwx9g-8080.app.github.dev"></script>

<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8;
    --accent:#2563eb; --accent2:#1d4ed8; --ok:#10b981; --ring:rgba(59,130,246,.35);
    --border:#20304f; --chip:#1f2a44; --chipOn:#243a7a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans KR",sans-serif}

  /* 레이아웃: 좌측 리스트 + 우측 지도 */
  .layout{display:grid; grid-template-columns: 360px 1fr; height:100vh}
  @media (max-width: 960px){
    .layout{ grid-template-columns: 1fr }
    .side{ position:fixed; z-index:30; left:12px; right:12px; top:12px }
    .mapwrap{ height:100vh }
  }

  .side{
    background:var(--panel); border:1px solid var(--border); border-radius:14px; margin:12px; padding:12px;
    display:flex; flex-direction:column; gap:10px; max-height: calc(100vh - 24px);
  }
  .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center }
  .title{ font-weight:800; display:flex; gap:8px; align-items:center; }
  .muted{ color:var(--muted) }
  .btn{ border:0; border-radius:10px; padding:8px 12px; font-weight:700; cursor:pointer;
    background:linear-gradient(180deg,var(--accent),var(--accent2)); color:#fff }
  .btn.ghost{ background:transparent; color:#c7d2fe; border:1px solid var(--border) }
  .chipbar{ display:flex; gap:8px; flex-wrap:wrap }
  .chip{
    background:var(--chip); border:1px solid var(--border); color:#c7d2fe;
    padding:8px 12px; border-radius:999px; cursor:pointer; user-select:none; font-weight:700; font-size:.92rem;
  }
  .chip.active{ background:var(--chipOn); color:#fff; border-color:transparent }
  .list{ overflow:auto; border:1px solid var(--border); border-radius:12px; flex:1; min-height: 140px }
  .item{ padding:10px 12px; border-bottom:1px solid var(--border); cursor:pointer; display:grid; gap:4px }
  .item:last-child{ border-bottom:0 }
  .item:hover{ background:rgba(37,99,235,.08) }
  .item.active{ outline:2px solid var(--accent); outline-offset:-2px; background:rgba(37,99,235,.12) }
  .nm{ font-weight:700 }
  .sub{ color:var(--muted); font-size:.92rem; display:flex; gap:6px; flex-wrap:wrap }
  .badge{ display:inline-block; font-size:.78rem; padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:#12203c }
  .dist{ color:#9ca3af }

  .mapwrap{ position:relative; }
  #map{ position:absolute; inset:0 }

  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;z-index:40;background:#111827;color:#fff;border:1px solid #374151;padding:10px 12px;border-radius:10px;display:none}

  /* 팝업 */
  .ol-popup{position:absolute;background:#111827;color:#e5e7eb;padding:8px 10px;border:1px solid #374151;border-radius:10px;
    min-width:200px;transform:translate(-50%,-110%);pointer-events:none}
  .ol-popup .tit{font-weight:700}
  .ol-popup .sub2{color:#9ca3af;font-size:.9rem}
</style>
</head>
<body>
  <div class="layout">
    <!-- 좌측 패널 (버튼과 리스트를 한 곳에 묶어 겹침 제거) -->
    <aside class="side">
      <div class="row title">
        <div>김천시 주차장 <span class="muted">반경 1km</span></div>
        <div class="muted" style="margin-left:auto">총 <b id="count">0</b>곳 · 선택: <b id="sel">-</b></div>
      </div>

      <div class="row">
        <button class="btn" id="locBtn">현재 위치</button>
        <button class="btn ghost" id="fitBtn">전체 보기</button>
        <button class="btn ghost" id="reloadAdminBtn">행정경계 갱신</button>
      </div>

      <div class="chipbar" id="typeBar" role="group" aria-label="주차장 형태 필터">
        <div class="chip active" data-type="">전체</div>
        <div class="chip" data-type="노상">노상</div>
        <div class="chip" data-type="노외">노외</div>
        <div class="chip" data-type="부설">부설</div>
      </div>

      <!-- 리스트 -->
      <div id="list" class="list" role="listbox" aria-label="주차장 목록"></div>
    </aside>

    <!-- 지도 -->
    <main class="mapwrap">
      <div id="map" aria-label="브이월드 2D 지도"></div>
    </main>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* =========================
   0) 상수/유틸 (전역 상태)
   ========================= */
const VWORLD_KEY    = "CF9A371B-35A6-3822-8315-6592C8342E82";
const VWORLD_DOMAIN = "psychic-pancake-r7q577jxr6ghwx9g-8080.app.github.dev";

const BASE_CENTER = { lng:128.1136, lat:36.1398 }; // 기본(김천시)
const RADIUS_M = 1000;                              // ★ 반경 1km
const $ = (s)=>document.querySelector(s);
const countEl = $('#count'), selEl = $('#sel'), toast = $('#toast');

let ORIGIN = { ...BASE_CENTER }; // 현재 원점(사용자 위치가 들어오면 갱신)
let currentType = "";            // '', '노상','노외','부설'

function showToast(msg, ms=2000){
  toast.textContent = msg; toast.style.display='block';
  clearTimeout(showToast._t); showToast._t=setTimeout(()=>toast.style.display='none', ms);
}
function km(a,b){
  const R=6371,toRad=d=>d*Math.PI/180;
  const dLat=toRad(b.lat-a.lat), dLng=toRad(b.lng-a.lng);
  const s1=Math.sin(dLat/2), s2=Math.sin(dLng/2);
  const t=s1*s1 + Math.cos(toRad(a.lat))*Math.cos(toRad(b.lat))*s2*s2;
  return 2*R*Math.asin(Math.sqrt(t));
}
function degBoxAround(lng, lat, kmRadius){
  const dLat = kmRadius/111;
  const dLng = kmRadius/(111*Math.cos(lat*Math.PI/180));
  return [lng-dLng, lat-dLat, lng+dLng, lat+dLat];
}
function inferType(name="", category="", addr=""){
  if(/노상/.test(name)||/노상/.test(category)) return "노상";
  if(/노외|공영|타워|주차타워/.test(name)||/노외|공영|타워/.test(category)) return "노외";
  if(/부설|몰|백화점|병원|학교|아파트/.test(name+addr)) return "부설";
  return "노외";
}

/* =========================
   1) 지도/레이어
   ========================= */
let vmap, vectorSrc, clusterSrc, clusterLayer, overlay;
let meLayer, radiusLayer, adminLayer; // ★ 행정경계 레이어

function initMap(){
  if(!(window.vw && vw.ol3 && window.ol)){ showToast('VWorld 로드 실패(apiKey/domain 확인)'); return; }

  vw.ol3.MapOptions = {
    basemapType: vw.ol3.BasemapType.GRAPHIC,
    controlDensity: vw.ol3.DensityType.EMPTY,
    interactionDensity: vw.ol3.DensityType.BASIC,
    controlsAutoArrange: true,
    homePosition: vw.ol3.CameraPosition,
    initPosition: vw.ol3.CameraPosition
  };
  vmap = new vw.ol3.Map("map", vw.ol3.MapOptions);

  const c = ol.proj.transform([ORIGIN.lng, ORIGIN.lat], 'EPSG:4326', 'EPSG:3857');
  vmap.getView().setCenter(c); vmap.getView().setZoom(14);

  vectorSrc   = new ol.source.Vector({ features: [] });
  clusterSrc  = new ol.source.Cluster({ distance: 40, minDistance: 10, source: vectorSrc });
  clusterLayer= new ol.layer.Vector({ source: clusterSrc, style: clusterStyle });
  meLayer     = new ol.layer.Vector({ source: new ol.source.Vector() });
  radiusLayer = new ol.layer.Vector({ source: new ol.source.Vector() });
  adminLayer  = new ol.layer.Vector({ source: new ol.source.Vector() }); // ★ 행정경계

  const realMap = (vmap.addLayer ? vmap : (vmap.getMap? vmap.getMap():vmap.map));
  realMap.addLayer(clusterLayer);
  realMap.addLayer(adminLayer);  // ★ 경계는 마커 아래/위 중 선택 → 여기서는 마커 '아래'면 가려지니 '위'로 올립니다.
  realMap.removeLayer(adminLayer); realMap.addLayer(adminLayer); // 위로 올리기
  realMap.addLayer(radiusLayer);
  realMap.addLayer(meLayer);

  const el = document.createElement('div');
  el.className = 'ol-popup';
  overlay = new ol.Overlay({ element: el, positioning: 'bottom-center', stopEvent: false, offset: [0, -12] });
  (vmap.addOverlay ? vmap.addOverlay(overlay) : realMap).addOverlay?.(overlay);

  vmap.on('click', function(evt){
    let handled = false;
    vmap.forEachFeatureAtPixel(evt.pixel, function(feature, layer){
      if(layer !== clusterLayer) return;
      const members = feature.get('features') || [];
      if(members.length > 1){
        const extent = ol.extent.createEmpty();
        members.forEach(f => ol.extent.extend(extent, f.getGeometry().getExtent()));
        vmap.getView().fit(extent, { duration: 300, maxZoom: 17, padding: [40,20,40,380] });
      }else if(members.length === 1){
        const f = members[0]; const p = f.getProperties();
        overlay.setPosition(evt.coordinate);
        overlay.getElement().innerHTML =
          `<div class="tit">${p.nm || '주차장'}</div>
           <div class="sub2">${p.addr || ''}</div>
           <div class="sub2">형태: ${p.type || '주차장'} · 좌표: ${Number(p.lat).toFixed(5)}, ${Number(p.lng).toFixed(5)}</div>`;
        selEl.textContent = p.nm || '주차장';
        highlightListItem(p.nm);
      }
      handled = true; return true;
    });
    if(!handled) overlay.setPosition(undefined);
  });
}

const PARK_ICON_SVG = `
<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 36 36'>
  <circle cx='18' cy='18' r='16' fill='#2563eb'/>
  <text x='18' y='22' font-family='Arial,Helvetica,sans-serif' font-size='16' text-anchor='middle' fill='#fff' font-weight='700'>P</text>
</svg>`;
function clusterStyle(feature){
  const size = (feature.get('features')||[]).length;
  if(size > 1){
    return new ol.style.Style({
      image: new ol.style.Circle({
        radius: Math.max(12, Math.min(28, 10 + Math.log(size)*8)),
        fill: new ol.style.Fill({ color: [37,99,235,0.85] }),
        stroke: new ol.style.Stroke({ color: '#ffffff', width: 2 })
      }),
      text: new ol.style.Text({
        text: String(size),
        fill: new ol.style.Fill({ color: '#ffffff' }),
        stroke: new ol.style.Stroke({ color: '#000000', width: 3 })
      })
    });
  }
  return new ol.style.Style({
    image: new ol.style.Icon({
      src: 'data:image/svg+xml;utf8,' + encodeURIComponent(PARK_ICON_SVG.trim()),
      scale: 1.0, anchor:[0.5,0.5], anchorXUnits:'fraction', anchorYUnits:'fraction'
    })
  });
}

/* =========================
   2) 데이터 로드 + 테스트 데이터 보강 + 반경 필터
   ========================= */
let RAW = [];  // 원본(검색 + 데모)
let VIEW = []; // 반경/타입 적용 후 화면 표시

async function vworldPlaceSearch(query, page=1, size=100){
  const url = `https://api.vworld.kr/req/search?service=search&request=search&version=2.0`
            + `&format=json&errorformat=json&crs=EPSG:4326&type=place`
            + `&size=${size}&page=${page}&key=${encodeURIComponent(VWORLD_KEY)}`
            + `&domain=${encodeURIComponent(VWORLD_DOMAIN)}`
            + `&query=${encodeURIComponent(query)}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error('VWorld 요청 실패');
  const json = await res.json();
  if(json.response && json.response.status==='OK') return json.response.result.items||[];
  return [];
}

function seedDemoAroundOrigin(n=30){
  const out=[];
  for(let i=0;i<n;i++){
    const r = Math.random()*0.8 + 0.05; // km
    const ang = Math.random()*Math.PI*2;
    const dLat = (r/111)*Math.sin(ang);
    const dLng = (r/(111*Math.cos(ORIGIN.lat*Math.PI/180)))*Math.cos(ang);
    const lat = ORIGIN.lat + dLat, lng = ORIGIN.lng + dLng;
    const types = ['노상','노외','부설'];
    const t = types[i%3];
    out.push({
      id:`DEMO-${i}`, nm:`데모 ${t} 주차장 ${i+1}`, lng, lat, addr:`김천시 데모로 ${i+1}`, type:t
    });
  }
  return out;
}

async function loadParking(){
  try{
    let items = [];
    // 김천 범위 내 검색
    items = items.concat(await vworldPlaceSearch('김천시 주차장',1,100));
    items = items.concat(await vworldPlaceSearch('김천 주차',1,100));

    const seen = new Set(); const rows = [];
    for(const it of items){
      const lng = Number(it.point?.x), lat = Number(it.point?.y);
      if(!isFinite(lng)||!isFinite(lat)) continue;
      const title = String(it.title||'');
      const road  = it.address?.road || it.address?.parcel || '';
      const cat   = it.category || '';
      if(!(/김천/.test(road)||/김천/.test(title))) continue;
      if(!(/주차/.test(road)||/주차/.test(title))) continue;
      const t = inferType(title, cat, road);
      const key = `${title}@${lng.toFixed(6)},${lat.toFixed(6)}`;
      if(seen.has(key)) continue; seen.add(key);
      rows.push({ id:key, nm:title, lng, lat, addr:road, type:t });
    }
    // 테스트 데이터 보강
    RAW = rows.concat(seedDemoAroundOrigin(30));
  }catch(e){
    console.warn('검색 실패, 데모만 사용', e);
    RAW = seedDemoAroundOrigin(30);
  }
  recompute();
}

/* 현재 ORIGIN 기준 1km 내 + 타입 필터 */
function recompute(){
  const within = RAW.map(r=>{
    const dkm = km(ORIGIN, {lng:r.lng, lat:r.lat});
    return { ...r, distKm: dkm };
  }).filter(r => r.distKm*1000 <= RADIUS_M);

  const rows = within.filter(r => !currentType || r.type===currentType)
                     .sort((a,b)=>a.distKm - b.distKm);

  VIEW = rows;
  buildList(rows);
  rebuildMarkers(rows);
}

/* =========================
   3) 리스트 UI
   ========================= */
function buildList(rows){
  const list = $('#list');
  if(rows.length===0){
    list.innerHTML = `<div class="item"><div class="nm">결과 없음</div><div class="sub">반경 1km / 형태: ${currentType||'전체'}</div></div>`;
    countEl.textContent = '0';
    return;
  }
  list.innerHTML = rows.map((r,i)=>`
    <div class="item" data-id="${r.id}" role="option" tabindex="0">
      <div class="nm">${i+1}. ${r.nm}</div>
      <div class="sub">
        <span class="badge">${r.type}</span>
        <span class="dist">${r.distKm.toFixed(2)} km</span>
        <span>${r.addr||''}</span>
      </div>
    </div>
  `).join('');
  countEl.textContent = String(rows.length);

  list.querySelectorAll('.item').forEach(el=>{
    el.addEventListener('click', ()=> focusItem(el.dataset.id));
    el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ focusItem(el.dataset.id); e.preventDefault(); } });
  });
}
function highlightListItem(name){
  const list = $('#list');
  list.querySelectorAll('.item').forEach(el=> el.classList.remove('active'));
  const el = Array.from(list.querySelectorAll('.item')).find(x => x.querySelector('.nm')?.textContent.includes(name));
  if(el){ el.classList.add('active'); el.scrollIntoView({block:'nearest', behavior:'smooth'}); }
}
function focusItem(id){
  const r = VIEW.find(x => x.id===id);
  if(!r) return;
  const coord = ol.proj.transform([r.lng, r.lat],'EPSG:4326','EPSG:3857');
  vmap.getView().setCenter(coord); vmap.getView().setZoom(16);
  overlay.setPosition(coord);
  overlay.getElement().innerHTML =
    `<div class="tit">${r.nm}</div>
     <div class="sub2">${r.addr||''}</div>
     <div class="sub2">형태: ${r.type} · 좌표: ${r.lat.toFixed(5)}, ${r.lng.toFixed(5)}</div>`;
  selEl.textContent = r.nm;
  highlightListItem(r.nm);
}

/* =========================
   4) 마커(클러스터)
   ========================= */
function rebuildMarkers(rows){
  const feats = rows.map(r=>{
    const coord = ol.proj.transform([r.lng, r.lat], 'EPSG:4326', 'EPSG:3857');
    const f = new ol.Feature({ geometry:new ol.geom.Point(coord) });
    f.setProperties({ nm:r.nm, addr:r.addr, type:r.type, lng:r.lng, lat:r.lat });
    return f;
  });
  vectorSrc.clear(); vectorSrc.addFeatures(feats);
}

/* =========================
   5) 현재 위치 & 1km 원
   ========================= */
function setOrigin(lng, lat, fly=true){
  ORIGIN = {lng, lat};
  drawOrigin(lng, lat);
  if(fly){
    const c = ol.proj.transform([lng,lat],'EPSG:4326','EPSG:3857');
    vmap.getView().setCenter(c); vmap.getView().setZoom(15);
  }
  recompute();
  loadAdminBoundaries(); // ★ 원점 바뀔 때 경계도 갱신
}
function drawOrigin(lng, lat){
  // 사람 아이콘
  const PERSON_ICON_SVG = `
  <svg xmlns='http://www.w3.org/2000/svg' width='38' height='38' viewBox='0 0 38 38'>
    <defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'>
      <stop offset='0' stop-color='#0ea5e9'/><stop offset='1' stop-color='#2563eb'/></linearGradient></defs>
    <path d='M19 0c9 0 16 7 16 16 0 9-8 17-16 22-8-5-16-13-16-22C3 7 10 0 19 0z' fill='url(#g)'/>
    <circle cx='19' cy='12' r='5' fill='#fff'/>
    <path d='M10 26c2-5 6-7 9-7s7 2 9 7' stroke='#fff' stroke-width='3' fill='none' stroke-linecap='round'/>
  </svg>`;
  const c = ol.proj.transform([lng, lat], 'EPSG:4326', 'EPSG:3857');
  const me = new ol.Feature({ geometry: new ol.geom.Point(c) });
  me.setStyle(new ol.style.Style({
    image:new ol.style.Icon({
      src: 'data:image/svg+xml;utf8,'+encodeURIComponent(PERSON_ICON_SVG.trim()),
      scale:1.0, anchor:[0.5,1], anchorXUnits:'fraction', anchorYUnits:'fraction'
    })
  }));
  meLayer.getSource().clear(); meLayer.getSource().addFeature(me);

  // 1km 원
  const circle = new ol.geom.Circle(c, RADIUS_M);
  const feat = new ol.Feature(circle);
  feat.setStyle(new ol.style.Style({
    stroke:new ol.style.Stroke({ color:[220,38,38,0.9], width:2 }), // 경계와 구분되게 붉은색 테두리
    fill:new ol.style.Fill({ color:[220,38,38,0.12] })
  }));
  radiusLayer.getSource().clear(); radiusLayer.getSource().addFeature(feat);
}

function getMyLocation(){
  const secureOK = (location.protocol==='https:') || ['localhost','127.0.0.1','::1'].includes(location.hostname);
  if(!secureOK){ showToast('현재 위치는 HTTPS 또는 localhost에서만 사용 가능'); return; }
  if(!navigator.geolocation){ showToast('이 기기에서 위치를 지원하지 않습니다.'); return; }
  navigator.geolocation.getCurrentPosition(pos=>{
    setOrigin(pos.coords.longitude, pos.coords.latitude, true);
  }, _=> showToast('위치 접근 거부/실패'), { enableHighAccuracy:true, timeout:8000, maximumAge:10000 });
}

/* =========================
   6) 행정경계 (시/구) – 붉은색 선
   ========================= */
async function fetchWFS(typename, bbox4326){
  // VWorld WFS: GeoJSON
  const url = `https://api.vworld.kr/req/wfs?service=WFS&request=GetFeature&version=1.0.0`
            + `&typename=${encodeURIComponent(typename)}`
            + `&outputFormat=application/json&srsName=EPSG:4326`
            + `&bbox=${bbox4326.join(',')},EPSG:4326`
            + `&key=${encodeURIComponent(VWORLD_KEY)}&domain=${encodeURIComponent(VWORLD_DOMAIN)}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error('WFS 요청 실패');
  return await res.json();
}

async function loadAdminBoundaries(){
  try{
    const bbox = degBoxAround(ORIGIN.lng, ORIGIN.lat, 10); // ORIGIN 기준 10km 박스
    // ★ 흔히 사용되는 VWorld 행정경계 레이어명 (시도/시군구)
    const T_SIDO = 'lt_c_adsido'; // (서비스에 따라 대소문자 다를 수 있음)
    const T_SIGG = 'lt_c_adsigg';

    const [sido, sigg] = await Promise.all([
      fetchWFS(T_SIDO, bbox).catch(_=>null),
      fetchWFS(T_SIGG, bbox).catch(_=>null),
    ]);

    const fmt = new ol.format.GeoJSON();
    const src = adminLayer.getSource();
    src.clear();

    const add = (geojson, color) =>{
      if(!geojson) return;
      const feats = fmt.readFeatures(geojson, { dataProjection:'EPSG:4326', featureProjection:'EPSG:3857' });
      feats.forEach(f=>{
        f.setStyle(new ol.style.Style({
          stroke:new ol.style.Stroke({ color, width:2.2 }),
          fill: null
        }));
      });
      src.addFeatures(feats);
    };
    add(sido, 'rgba(239,68,68,0.95)'); // 진한 빨강
    add(sigg, 'rgba(239,68,68,0.95)');

  }catch(e){
    console.warn('행정경계 로드 실패', e);
    showToast('행정경계 로드 실패(계정/도메인/레이어명 확인)');
  }
}

/* =========================
   7) 타입 칩 동작
   ========================= */
function initTypeBar(){
  const bar = $('#typeBar');
  bar.addEventListener('click', (e)=>{
    const chip = e.target.closest('.chip'); if(!chip) return;
    bar.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
    chip.classList.add('active');
    currentType = chip.dataset.type || "";
    recompute();
  });
}

/* =========================
   8) 시작
   ========================= */
async function start(){
  initMap();
  initTypeBar();

  // 현재 위치 먼저 시도
  getMyLocation();

  // 데이터 로드 (+데모 보강)
  await loadParking();

  // 행정경계 로드 (초기 ORIGIN 기준)
  await loadAdminBoundaries();

  showToast('좌측 목록에서 주차장을 선택하세요');
}

/* 좌측 버튼 */
document.getElementById('locBtn').addEventListener('click', getMyLocation);
document.getElementById('fitBtn').addEventListener('click', ()=>{
  const extent = ol.extent.createEmpty();
  radiusLayer.getSource().getFeatures().forEach(f=> ol.extent.extend(extent, f.getGeometry().getExtent()));
  vectorSrc.getFeatures().forEach(f=> ol.extent.extend(extent, f.getGeometry().getExtent()));
  if(!ol.extent.isEmpty(extent)){
    vmap.getView().fit(extent, {duration:400, padding:[40,20,40,380], maxZoom:16});
  }
});
document.getElementById('reloadAdminBtn').addEventListener('click', loadAdminBoundaries);

/* 리스트에서 항목 클릭 시 포커스 */
function focusItem(id){
  const r = VIEW.find(x => x.id===id);
  if(!r) return;
  const coord = ol.proj.transform([r.lng, r.lat],'EPSG:4326','EPSG:3857');
  vmap.getView().setCenter(coord); vmap.getView().setZoom(16);
  overlay.setPosition(coord);
  overlay.getElement().innerHTML =
    `<div class="tit">${r.nm}</div>
     <div class="sub2">${r.addr||''}</div>
     <div class="sub2">형태: ${r.type} · 좌표: ${r.lat.toFixed(5)}, ${r.lng.toFixed(5)}</div>`;
  selEl.textContent = r.nm;
  highlightListItem(r.nm);
}

start();
</script>
</body>
</html>